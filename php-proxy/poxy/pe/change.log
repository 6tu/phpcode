
/*---------------------------修改记录（截止20110611下午）---------------------------*/

对HTML数据作如下的改动：

* 对COOKIE的一些值加密
* 国家化，不同的编码的数据统一为UTF-8，但一些不规范的网页在编码转换时可能出错，尤其是亚洲国家的文字编码，所以不怎么完善，
* UTF-8转成HTML实体，主要对多字节文字使用，防止关键字
* 在HTML实体的基础上增加了加密选项，加密算法简单，同一数据的密文随机改变，进一步防止关键字，但这将消耗更多的 S/C 资源，所以浏览明显变慢
* 对URL不仅仅是用BASE64编码，采用比较复杂的加密模式
* 更改了压缩方法，只压缩 text 数据
* 保持原网页编码不加密的选项
* 完善了URL分析
* 增加了自定义编码，如果遇到乱码或者无法显示的网页，可以在网址的 iso= 后面指定或取消编码

其它改动：

* 首次提交的网址在客户端进行多次简单的编码，所以看上去是乱码
* 支持设定默认的代理网站
* 支持限制一些国家的网民使用此代理，以节省资源
* 支持白名单，在白名单的网站走指定的代理服务器
* 实现多语种，目前支持简体、繁体和英文
* 更改了风格，增加常用链接
* added by felix021 for block-divided downloading
* 增加了用户认证 
* ACCEPT_LANGUAGE 和 USER_AGENT 被使用和修改
* 对常用的网址作了简短URL，但是这需要服务器支持rewrite模块(同时AllowOverride all)，
  否则请在index.php文件的file_put_contents('.htaccess',$base);前加 // ，并删除 .htaccess 文件
* 支持在线检测版本
* 增加管理模块
* 修正了一些错误

在线代理的普遍缺点，需要专用的插件：

* 对AJAX支持的一塌糊涂
* 对FLASH也不支持

/*---------------------------乱码的处理方法---------------------------*/

** 发送中文数据返回乱码:

一般的php.ini的 default_charset = "ISO-8859-1" ，而一些英文论坛默认编码并不是 utf-8 、 GBK，而是 ISO-8859-1 ，所以把发送的数据按照 ISO-8859-1 处理，或者经过两次UTF-8编码存储。

1. 把提交数据的页面在浏览器中调整为中文编码 
2. 开启代理中倒数第三行 header("Content-type: text/html;charset=$charset"); 并指定为 GBK，但这将造成加载的风格文件丢失
3. 修改php.ini 中的 default_charset = "ISO-8859-1"

** 浏览的网页乱码或者无法显示的网页:

  可以在网址的 iso= 后面指定或取消编码，编码有它的代码页(page code) 和 Unix码(EUC: Extended Unix Code，这个很少用)或许还
  有其它的标记，比如 GB2312 的代码页是 CP936 Unix码是 EUC-CN ，而阿拉伯语太多的时候使用 windows-1256 而非 iso-8859-6等，
  有时候使用国家简称或许也可以，比如 zh-cn

  GBK编码包含 繁体中文字，日文字符，朝鲜字符和 ISO-8859-1 ，更多的ISO 8859附有编码表 


/*---------------------------遇到的问题－－JS解码---------------------------*/

由于PHP和JS默认的编码格式的不同，导致PHP编码后的多字节数据在JS中不能正确解码，而单字节
数据则不存在这样的问题，为了使JS能正确解密PHP加密的数据，使用了HTML实体和BASE64编码，但
是这对多字节字符将非常耗费服务器和客户端的CPU和带宽，尤其让客户端的JS处理BASE64编码，那
真是为难，所以如何使用合适的编码是关键

一份中文数据的比较

        原数据  HTML实体 HTML加密

未压缩  83 KB   311 KB   415 KB                 
有压缩  49 KB   59 KB    85 KB 
比例    2       5        5            
CPU耗时 不明显  不明显   100% 42s

所以使用不加密的压缩方式浏览比较合适
 

/*---------------------------要完成的项---------------------------*/

- 支持 HTTP 摘要
- 支持一些视屏网站
- 对一些论坛作精简格式，适合手机访问


/*---------------------------原作者要完成的项(17:7)---------------------------*/

- Cookie 管理    ==> 
- 支持JavaScript    ==> 仅用来加解密数据，不知道原作要JS支持什么
- 支持外部代理服务器    ==> 这个可以参照 surrogafier，条件许可，将使用 tor 等代理
- 不包含URL表框的 Frames 和 iframes 标签    ==> 
- 缓存选项    ==> 
- 更多编码URL的方法    ==> 完成
- 更多的浏览选项    ==> 添加了html加密选项
- 支持 HTTP 摘要    ==> 
- 支持 HTTP 1.1    ==> 对一些网站会缓慢，放弃
- 支持更多的响应专用 headers    ==> 有改
- 更好的 "hosts" 控制    ==> 完成
- 引进 URL proxification    ==> ？
- 检查 gzip 压缩条件    ==> 完成
- 代理 XML 数据    ==> 
- 支持多语种    ==> 完成
- 支持 IDN    ==> 国际化域名，也称多语种域名 IDNs (Internationalized Domain Names)
- 支持 FTP    ==> 


/*---------------------------编码表---------------------------*/

ISO 8859 包括128个ASCII字符，并新增128个字符，用于西欧国家语言

字符集(charset)

ISO-8859-1    Latin1                  北美、西欧、拉丁美洲、加勒比海、加拿大、非洲              

ISO-8859-2    Latin2                  东欧国家语言 Czech(cs)  Hungarian(hu)  Croation(hr) Polish(pl) 
                                                    Romanian(ro)  Serbian(sr) Slovak(sk) Slovenian(sl)
                                                    Albanian(sq) Latvian(lv) Lithuanian(lt)
  
ISO-8859-3    Latin3                  SE Europe、世界语、其他杂项 Maltese(mt) Esperanto(eo)

ISO-8859-4    Latin4                  斯堪的纳维亚/波罗的海（以及其他没有包括在 ISO-8859-1 中的部分）
 
ISO-8859-5    Latin/Cyrillic5         古代斯拉夫语字母表的语言，比如保加利亚语、白俄罗斯文、俄罗斯语、马其顿语
                                      Russian(ru) Bulgarian(bg) Byelorussian(be) Macedonian(mk) Ukrainian(uk)

ISO-8859-6    Latin/Arabic6           阿拉伯语言 Arabic(ar)

ISO-8859-7                            Greek(el)
ISO-8859-8                            Hebrew(he)  Hebrew(iw)
ISO-8859-9                            Turkish(tr)
ISO-8859-10   Latin6                  拉普兰语、日耳曼语、爱斯基摩北欧语 

ISO-8859-15   Latin9 (aka Latin 0)    与 ISO 8859-1 类似，欧元符号和其他一些字符取代了一些较少使用的符号 
ISO-2022-JP   Latin/Japanese1         日本语 
ISO-2022-JP-2 Latin/Japanese2         日本语 
ISO-2022-KR   Latin/Korean1           韩语 























