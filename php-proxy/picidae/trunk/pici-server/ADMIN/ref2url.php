<?php/* --------------------------------------------------------------------------pici-server of the artproject picidae http://www.picidae.netCopyright (c) 2007  picidae.net by christoph wachter and mathias judThis program is free software; you can redistribute it and/ormodify it under the terms of the GNU General Public Licenseas published by the Free Software Foundation; either version 2of the License, or (at your option) any later version.This program is distributed in the hope that it will be useful,but WITHOUT ANY WARRANTY; without even the implied warranty ofMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See theGNU General Public License for more details.You should have received a copy of the GNU General Public Licensealong with this program; if not, write to the Free SoftwareFoundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA. -------------------------------------------------------------------------- */// --------------------------------------------------------------------------// variables// --------------------------------------------------------------------------// --------------------------------------------------------------------------// helpers// --------------------------------------------------------------------------// --------------------------------------------------------------------------// functions// --------------------------------------------------------------------------function ref2url($ref, $DB_link, $DB_table)		{	global $timelimit_links;		// check whether the data exists	$qryStmt = "SELECT * from $DB_table where ref = '$ref';";		if ($exists_query=mysql_query(sprintf($qryStmt), $DB_link)) 	{		//wieviele resultate		$numrows = mysql_num_rows($exists_query);	}					// Daten in Array packen und zurckgeben	if ($numrows > 0)	{		$result_array["idx"] = DemaskString(mysql_result($exists_query, 0, "idx"));		$result_array["url"] = DemaskString(mysql_result($exists_query, 0, "url"));		$result_array["idx_url"] = DemaskString(mysql_result($exists_query, 0, "idx_url"));						return $result_array;	} 	else 	{		// false zurckgeben		return false;	}}// --------------------------------------------------------------------------function formref2url($ref, $DB_link, $DB_table)		{	global $timelimit_links;		// check whether the data exists	//nach daten durchsuchen	//$timeout = timestamp - $timelimit_links * 1000;	//$qryStmt = "SELECT * from $DB_table where ref = '$ref' and created > '$timeout';"; 	$qryStmt = "SELECT * from $DB_table where ref = '$ref';";		if ($exists_query=mysql_query(sprintf($qryStmt), $DB_link)) 	{		//wieviele resultate		$numrows = mysql_num_rows($exists_query);	}					// Daten in Array packen und zurckgeben	if ($numrows > 0)	{		$key = DemaskString(mysql_result($exists_query, 0, "cipher_key"));		$url = DemaskString(mysql_result($exists_query, 0, "url"));		$url .= "?";				// variables		$formfields = DemaskString(mysql_result($exists_query, 0, "formfields"));		if ($formfields && $formfields != "")		{			$formfields_array = explode ("#",$formfields);			$first = true;						foreach ($formfields_array as $v)			{				if ($v && $v != "")				{					if (!$first) $url .= "&";					else $first = false;										$url .= "$v=";										if (isset($_REQUEST[$v]))					{						if (isset($_REQUEST["c"]) && $_REQUEST["c"] == 1) 						{							$tmp = pici_decrypt ($key, $_REQUEST[$v]);														if (!eregi('%',$tmp)) $url .= urlencode($tmp);							else $url .= $tmp;													}						else 						{							$url .= urlencode($_REQUEST[$v]);						}					}				}			}		}				// hidden variables		$url .= DemaskString(mysql_result($exists_query, 0, "hiddenfields"));				$url_array["url"] = $url;		$url_array["key"] = $key;				return $url_array;	} 	else 	{		// false zurckgeben		return false;	}}?>